(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{7118:function(e,s,t){Promise.resolve().then(t.bind(t,7006))},7006:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return c}});var a=t(7437),r=t(2265),l=e=>{let{buildingData:s,buildings:t,activeBuilding:r,onBuildingChange:l,onCellClick:n,isLoading:d}=e,i=t.sort(),c=new Set,o=new Set;i.forEach(e=>{let t=s[e]||{};Object.keys(t).forEach(e=>{c.add(e),Object.keys(t[e]||{}).forEach(e=>o.add(e))})});let x=["1号","2号","3号","4号"],m=e=>{if(!e)return{text:"无数据",color:"bg-gray-200 text-gray-500"};switch(e.status){case"safe":return{text:"安全",color:"bg-green-500 text-white"};case"danger":return{text:"危险",color:"bg-red-500 text-white"};case"emergency":return{text:"紧急",color:"bg-red-700 text-white"};default:return{text:"无数据",color:"bg-gray-200 text-gray-500"}}};return d?(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)("table",{className:"min-w-full border-collapse border border-gray-300",children:[(0,a.jsx)("thead",{children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"w-20 border p-2 bg-gray-50 text-left",children:"楼层"}),x.map((e,s)=>(0,a.jsx)("th",{className:"w-20 border p-2 bg-gray-50 text-center",children:(0,a.jsx)("div",{className:"skeleton h-6 bg-gray-200 rounded"})},e))]})}),(0,a.jsx)("tbody",{children:Array(10).fill(0).map((e,s)=>(0,a.jsxs)("tr",{children:[(0,a.jsx)("td",{className:"border p-2 bg-gray-50 font-medium",children:(0,a.jsx)("div",{className:"skeleton h-6 bg-gray-200 rounded"})}),x.map((e,s)=>(0,a.jsx)("td",{className:"border p-2",children:(0,a.jsx)("div",{className:"skeleton h-16 w-full bg-gray-200 rounded"})},s))]},s))})]})}):(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"flex flex-wrap gap-2 items-center",children:[(0,a.jsx)("span",{className:"text-sm font-medium text-gray-700",children:"楼栋选择："}),i.map(e=>(0,a.jsx)("button",{className:"px-4 py-2 rounded-md transition-colors ".concat(r===e?"bg-blue-600 text-white shadow-md":"bg-gray-200 text-gray-700 hover:bg-gray-300"),onClick:()=>l(e),children:e},e))]}),(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)("table",{className:"min-w-full border-collapse border border-gray-300",children:[(0,a.jsx)("thead",{children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"w-20 border p-2 bg-gray-50 text-left font-semibold",children:"楼层"}),x.map(e=>(0,a.jsx)("th",{className:"w-20 border p-2 bg-gray-50 text-center font-semibold",children:e},e))]})}),(0,a.jsx)("tbody",{children:["1楼","2楼","3楼","4楼","5楼","6楼","7楼","8楼"].map(e=>(0,a.jsxs)("tr",{children:[(0,a.jsx)("td",{className:"border p-2 bg-gray-50 font-medium",children:e}),x.map(t=>{let l=((s[r]||{})[e]||{})[t],d=m(l);return(0,a.jsx)("td",{onClick:()=>l&&n(l),className:"border p-2 text-center cursor-pointer transition-all duration-200 hover:scale-105 hover:shadow-md ".concat(d.color),title:l?"点击查看".concat(r).concat(e).concat(t,"详情"):"无数据",children:(0,a.jsx)("div",{className:"text-xs",children:(0,a.jsx)("div",{className:"font-medium",children:d.text})})},t)})]},e))})]})}),(0,a.jsxs)("div",{className:"text-sm text-gray-600",children:[(0,a.jsx)("p",{children:"• 表格显示所有可能的楼层（1楼-8楼）和房间号（1号-4号）"}),(0,a.jsx)("p",{children:"• 点击楼栋按钮可以切换显示不同楼栋的数据"}),(0,a.jsx)("p",{children:"• 点击单元格可以查看详细记录"})]})]})},n=e=>{let{isOpen:s,records:t,onClose:r}=e;if(!s||0===t.length)return(0,a.jsx)("div",{className:"bg-white border border-gray-200 rounded-lg shadow-sm p-6",children:(0,a.jsxs)("div",{className:"text-center text-gray-500",children:[(0,a.jsx)("svg",{className:"mx-auto h-12 w-12 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),(0,a.jsx)("h3",{className:"mt-2 text-sm font-medium text-gray-900",children:"暂无数据"}),(0,a.jsx)("p",{className:"mt-1 text-sm text-gray-500",children:"请点击表格中的单元格查看详情"})]})});let l=e=>e.includes("安全")?"bg-status-safe":e.includes("危险")?"bg-status-danger":e.includes("生命危险")?"bg-status-emergency":"bg-gray-500",n=e=>new Date(e).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"});return(0,a.jsxs)("div",{className:"bg-white border border-gray-200 rounded-lg shadow-sm",children:[(0,a.jsxs)("div",{className:"p-4 border-b bg-gray-50",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"详情信息"}),(0,a.jsxs)("p",{className:"text-sm text-gray-500 mt-1",children:["共 ",t.length," 条记录"]})]}),(0,a.jsx)("div",{className:"max-h-96 overflow-y-auto",children:t.map((e,s)=>{var t;let{安全状态:r,受伤情况:d,特殊情况:i,补充说明:c,提交时间:o,提交人:x,楼栋号:m,楼层:h,房号:g}=e.fields;return(0,a.jsxs)("div",{className:"p-4 border-b last:border-b-0",children:[(0,a.jsxs)("div",{className:"flex items-center mb-3",children:[(0,a.jsx)("div",{className:"w-3 h-3 rounded-full mr-2 ".concat(l(r))}),(0,a.jsx)("h4",{className:"font-medium text-gray-900",children:r}),(0,a.jsx)("span",{className:"ml-auto text-sm text-gray-500",children:n(o)})]}),(0,a.jsxs)("div",{className:"space-y-2 text-sm",children:[(0,a.jsxs)("p",{children:[(0,a.jsx)("span",{className:"font-medium text-gray-700",children:"位置："}),(0,a.jsxs)("span",{className:"text-gray-900",children:[m,h,g]})]}),(0,a.jsxs)("p",{children:[(0,a.jsx)("span",{className:"font-medium text-gray-700",children:"提交人："}),(0,a.jsx)("span",{className:"text-gray-900",children:(null==x?void 0:null===(t=x[0])||void 0===t?void 0:t.name)||"未知"})]}),d&&(0,a.jsxs)("p",{children:[(0,a.jsx)("span",{className:"font-medium text-gray-700",children:"受伤情况："}),(0,a.jsx)("span",{className:"text-gray-900",children:d})]}),i&&i.length>0&&(0,a.jsxs)("p",{children:[(0,a.jsx)("span",{className:"font-medium text-gray-700",children:"特殊情况："}),(0,a.jsx)("span",{className:"text-gray-900",children:i.join("、")})]}),c&&c.length>0&&(0,a.jsxs)("p",{children:[(0,a.jsx)("span",{className:"font-medium text-gray-700",children:"补充说明："}),(0,a.jsx)("span",{className:"text-gray-900",children:c.map((e,s)=>(0,a.jsx)("span",{children:e.text},s))})]})]})]},e.record_id)})})]})},d=e=>{var s;let{stats:t,submitUrl:r}=e;return(0,a.jsxs)("div",{className:"mb-6",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-2",children:[(0,a.jsx)("h1",{className:"text-2xl font-bold",children:"报平安系统"}),r&&(0,a.jsx)("button",{onClick:()=>window.open(r,"_blank"),className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors duration-200",children:"我要提交信息"})]}),(0,a.jsxs)("div",{className:"text-sm text-gray-600",children:["共 ",t.totalRecords," 条数据，最后更新时间：",(s=t.lastUpdateTime)?new Date(s).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"}):"暂无数据"]})]})};let i={totalRecords:0,lastUpdateTime:0};var c=()=>{let[e,s]=(0,r.useState)({}),[t,c]=(0,r.useState)([]),[o,x]=(0,r.useState)(""),[m,h]=(0,r.useState)(!0),[g,u]=(0,r.useState)(!1),[j,b]=(0,r.useState)([]),[p,y]=(0,r.useState)(i),[N,f]=(0,r.useState)(null),v=async()=>{h(!0),f(null);try{let e=await fetch("/api/feishu/data",{cache:"no-store"}),t=await e.json();t.success?(s(t.data.buildingData),c(t.data.buildings),y(t.data.stats),t.data.buildings.length>0&&!o&&x(t.data.buildings[0])):f("获取数据失败")}catch(e){f("获取数据出错"),console.error("Error fetching data:",e)}finally{h(!1)}};return(0,r.useEffect)(()=>{v();let e=setTimeout(()=>{N&&v()},2e3);return()=>clearTimeout(e)},[N]),(0,a.jsxs)("div",{className:"max-w-full mx-auto p-4 sm:p-6 lg:p-8",children:[(0,a.jsx)(d,{stats:p,submitUrl:"https://jcnw9wufsa17.feishu.cn/share/base/form/shrcn3WM0DXq7ytKKSiG9dGqzKc"}),N&&(0,a.jsx)("div",{className:"mb-4 p-4 bg-red-100 text-red-700 rounded-md",children:N}),(0,a.jsxs)("div",{className:"flex gap-6",children:[(0,a.jsx)("div",{className:"flex-1",children:(0,a.jsx)(l,{buildingData:e,buildings:t,activeBuilding:o,onBuildingChange:e=>{x(e)},onCellClick:e=>{b(e.records),u(!0)},isLoading:m})}),(0,a.jsx)("div",{className:"w-96",children:(0,a.jsx)(n,{isOpen:g,records:j,onClose:()=>{u(!1)}})})]})]})}}},function(e){e.O(0,[971,117,744],function(){return e(e.s=7118)}),_N_E=e.O()}]);