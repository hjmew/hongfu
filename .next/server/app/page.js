(()=>{var e={};e.id=931,e.ids=[931],e.modules={2934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},4580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},5869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},1722:(e,s,t)=>{"use strict";t.r(s),t.d(s,{GlobalError:()=>l.a,__next_app__:()=>m,originalPathname:()=>x,pages:()=>c,routeModule:()=>h,tree:()=>o}),t(908),t(1506),t(5866);var r=t(3191),a=t(8716),n=t(7922),l=t.n(n),i=t(5231),d={};for(let e in i)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(d[e]=()=>i[e]);t.d(s,d);let o=["",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(t.bind(t,908)),"C:\\Users\\123\\Desktop\\hongfu\\app\\page.tsx"]}]},{layout:[()=>Promise.resolve().then(t.bind(t,1506)),"C:\\Users\\123\\Desktop\\hongfu\\app\\layout.tsx"],"not-found":[()=>Promise.resolve().then(t.t.bind(t,5866,23)),"next/dist/client/components/not-found-error"]}],c=["C:\\Users\\123\\Desktop\\hongfu\\app\\page.tsx"],x="/page",m={require:t,loadChunk:()=>Promise.resolve()},h=new r.AppPageRouteModule({definition:{kind:a.x.APP_PAGE,page:"/page",pathname:"/",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:o}})},1425:()=>{},5559:(e,s,t)=>{Promise.resolve().then(t.bind(t,1147))},4754:(e,s,t)=>{Promise.resolve().then(t.t.bind(t,2994,23)),Promise.resolve().then(t.t.bind(t,6114,23)),Promise.resolve().then(t.t.bind(t,9727,23)),Promise.resolve().then(t.t.bind(t,9671,23)),Promise.resolve().then(t.t.bind(t,1868,23)),Promise.resolve().then(t.t.bind(t,4759,23))},1147:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>o});var r=t(326),a=t(7577);let n=({buildingData:e,buildings:s,activeBuilding:t,onBuildingChange:a,onCellClick:n,isLoading:l})=>{let i=s.sort(),d=new Set,o=new Set;i.forEach(s=>{let t=e[s]||{};Object.keys(t).forEach(e=>{d.add(e),Object.keys(t[e]||{}).forEach(e=>o.add(e))})});let c=["1号","2号","3号","4号"],x=e=>{if(!e)return{text:"无数据",color:"bg-gray-200 text-gray-500"};switch(e.status){case"safe":return{text:"安全",color:"bg-green-500 text-white"};case"danger":return{text:"危险",color:"bg-red-500 text-white"};case"emergency":return{text:"紧急",color:"bg-red-700 text-white"};default:return{text:"无数据",color:"bg-gray-200 text-gray-500"}}};return l?r.jsx("div",{className:"overflow-x-auto",children:(0,r.jsxs)("table",{className:"min-w-full border-collapse border border-gray-300",children:[r.jsx("thead",{children:(0,r.jsxs)("tr",{children:[r.jsx("th",{className:"w-20 border p-2 bg-gray-50 text-left",children:"楼层"}),c.map((e,s)=>r.jsx("th",{className:"w-20 border p-2 bg-gray-50 text-center",children:r.jsx("div",{className:"skeleton h-6 bg-gray-200 rounded"})},e))]})}),r.jsx("tbody",{children:Array(10).fill(0).map((e,s)=>(0,r.jsxs)("tr",{children:[r.jsx("td",{className:"border p-2 bg-gray-50 font-medium",children:r.jsx("div",{className:"skeleton h-6 bg-gray-200 rounded"})}),c.map((e,s)=>r.jsx("td",{className:"border p-2",children:r.jsx("div",{className:"skeleton h-16 w-full bg-gray-200 rounded"})},s))]},s))})]})}):(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{className:"flex flex-wrap gap-2 items-center",children:[r.jsx("span",{className:"text-sm font-medium text-gray-700",children:"楼栋选择："}),i.map(e=>r.jsx("button",{className:`px-4 py-2 rounded-md transition-colors ${t===e?"bg-blue-600 text-white shadow-md":"bg-gray-200 text-gray-700 hover:bg-gray-300"}`,onClick:()=>a(e),children:e},e))]}),r.jsx("div",{className:"overflow-x-auto",children:(0,r.jsxs)("table",{className:"min-w-full border-collapse border border-gray-300",children:[r.jsx("thead",{children:(0,r.jsxs)("tr",{children:[r.jsx("th",{className:"w-20 border p-2 bg-gray-50 text-left font-semibold",children:"楼层"}),c.map(e=>r.jsx("th",{className:"w-20 border p-2 bg-gray-50 text-center font-semibold",children:e},e))]})}),r.jsx("tbody",{children:["1楼","2楼","3楼","4楼","5楼","6楼","7楼","8楼"].map(s=>(0,r.jsxs)("tr",{children:[r.jsx("td",{className:"border p-2 bg-gray-50 font-medium",children:s}),c.map(a=>{let l=((e[t]||{})[s]||{})[a],i=x(l);return r.jsx("td",{onClick:()=>l&&n(l),className:`border p-2 text-center cursor-pointer transition-all duration-200 hover:scale-105 hover:shadow-md ${i.color}`,title:l?`点击查看${t}${s}${a}详情`:"无数据",children:r.jsx("div",{className:"text-xs",children:r.jsx("div",{className:"font-medium",children:i.text})})},a)})]},s))})]})}),(0,r.jsxs)("div",{className:"text-sm text-gray-600",children:[r.jsx("p",{children:"• 表格显示所有可能的楼层（1楼-8楼）和房间号（1号-4号）"}),r.jsx("p",{children:"• 点击楼栋按钮可以切换显示不同楼栋的数据"}),r.jsx("p",{children:"• 点击单元格可以查看详细记录"})]})]})},l=({isOpen:e,records:s,onClose:t})=>{if(!e||0===s.length)return r.jsx("div",{className:"bg-white border border-gray-200 rounded-lg shadow-sm p-6",children:(0,r.jsxs)("div",{className:"text-center text-gray-500",children:[r.jsx("svg",{className:"mx-auto h-12 w-12 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),r.jsx("h3",{className:"mt-2 text-sm font-medium text-gray-900",children:"暂无数据"}),r.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"请点击表格中的单元格查看详情"})]})});let a=e=>e.includes("安全")?"bg-status-safe":e.includes("危险")?"bg-status-danger":e.includes("生命危险")?"bg-status-emergency":"bg-gray-500",n=e=>new Date(e).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"});return(0,r.jsxs)("div",{className:"bg-white border border-gray-200 rounded-lg shadow-sm",children:[(0,r.jsxs)("div",{className:"p-4 border-b bg-gray-50",children:[r.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"详情信息"}),(0,r.jsxs)("p",{className:"text-sm text-gray-500 mt-1",children:["共 ",s.length," 条记录"]})]}),r.jsx("div",{className:"max-h-96 overflow-y-auto",children:s.map((e,s)=>{let{安全状态:t,受伤情况:l,特殊情况:i,补充说明:d,提交时间:o,提交人:c,楼栋号:x,楼层:m,房号:h}=e.fields;return(0,r.jsxs)("div",{className:"p-4 border-b last:border-b-0",children:[(0,r.jsxs)("div",{className:"flex items-center mb-3",children:[r.jsx("div",{className:`w-3 h-3 rounded-full mr-2 ${a(t)}`}),r.jsx("h4",{className:"font-medium text-gray-900",children:t}),r.jsx("span",{className:"ml-auto text-sm text-gray-500",children:n(o)})]}),(0,r.jsxs)("div",{className:"space-y-2 text-sm",children:[(0,r.jsxs)("p",{children:[r.jsx("span",{className:"font-medium text-gray-700",children:"位置："}),(0,r.jsxs)("span",{className:"text-gray-900",children:[x,m,h]})]}),(0,r.jsxs)("p",{children:[r.jsx("span",{className:"font-medium text-gray-700",children:"提交人："}),r.jsx("span",{className:"text-gray-900",children:c?.[0]?.name||"未知"})]}),l&&(0,r.jsxs)("p",{children:[r.jsx("span",{className:"font-medium text-gray-700",children:"受伤情况："}),r.jsx("span",{className:"text-gray-900",children:l})]}),i&&i.length>0&&(0,r.jsxs)("p",{children:[r.jsx("span",{className:"font-medium text-gray-700",children:"特殊情况："}),r.jsx("span",{className:"text-gray-900",children:i.join("、")})]}),d&&d.length>0&&(0,r.jsxs)("p",{children:[r.jsx("span",{className:"font-medium text-gray-700",children:"补充说明："}),r.jsx("span",{className:"text-gray-900",children:d.map((e,s)=>r.jsx("span",{children:e.text},s))})]})]})]},e.record_id)})})]})},i=({stats:e,submitUrl:s})=>{let t;return(0,r.jsxs)("div",{className:"mb-6",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center mb-2",children:[r.jsx("h1",{className:"text-2xl font-bold",children:"报平安系统"}),s&&r.jsx("button",{onClick:()=>window.open(s,"_blank"),className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors duration-200",children:"我要提交信息"})]}),(0,r.jsxs)("div",{className:"text-sm text-gray-600",children:["共 ",e.totalRecords," 条数据，最后更新时间：",(t=e.lastUpdateTime)?new Date(t).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"}):"暂无数据"]})]})},d={totalRecords:0,lastUpdateTime:0},o=()=>{let[e,s]=(0,a.useState)({}),[t,o]=(0,a.useState)([]),[c,x]=(0,a.useState)(""),[m,h]=(0,a.useState)(!0),[u,g]=(0,a.useState)(!1),[p,b]=(0,a.useState)([]),[j,y]=(0,a.useState)(d),[f,N]=(0,a.useState)(null),v=async()=>{h(!0),N(null);try{let e=await fetch("/api/feishu/data",{cache:"no-store"}),t=await e.json();t.success?(s(t.data.buildingData),o(t.data.buildings),y(t.data.stats),t.data.buildings.length>0&&!c&&x(t.data.buildings[0])):N("获取数据失败")}catch(e){N("获取数据出错"),console.error("Error fetching data:",e)}finally{h(!1)}};return(0,a.useEffect)(()=>{v();let e=setTimeout(()=>{f&&v()},2e3);return()=>clearTimeout(e)},[f]),(0,r.jsxs)("div",{className:"max-w-full mx-auto p-4 sm:p-6 lg:p-8",children:[r.jsx(i,{stats:j,submitUrl:"https://jcnw9wufsa17.feishu.cn/share/base/form/shrcn3WM0DXq7ytKKSiG9dGqzKc"}),f&&r.jsx("div",{className:"mb-4 p-4 bg-red-100 text-red-700 rounded-md",children:f}),(0,r.jsxs)("div",{className:"flex gap-6",children:[r.jsx("div",{className:"flex-1",children:r.jsx(n,{buildingData:e,buildings:t,activeBuilding:c,onBuildingChange:e=>{x(e)},onCellClick:e=>{b(e.records),g(!0)},isLoading:m})}),r.jsx("div",{className:"w-96",children:r.jsx(l,{isOpen:u,records:p,onClose:()=>{g(!1)}})})]})]})}},1506:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>n,metadata:()=>a});var r=t(9510);t(7272);let a={title:"报平安 Web APP",description:"飞书表格数据可视化展示"};function n({children:e}){return r.jsx("html",{lang:"zh-CN",children:r.jsx("body",{children:e})})}},908:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>r});let r=(0,t(8570).createProxy)(String.raw`C:\Users\123\Desktop\hongfu\app\page.tsx#default`)},7272:()=>{}};var s=require("../webpack-runtime.js");s.C(e);var t=e=>s(s.s=e),r=s.X(0,[276,471],()=>t(1722));module.exports=r})();